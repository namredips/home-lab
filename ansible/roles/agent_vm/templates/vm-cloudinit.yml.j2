#cloud-config
hostname: {{ agent_name }}
fqdn: {{ agent_name }}.infiquetra.com
manage_etc_hosts: true

users:
  - name: {{ vm_ssh_user }}
    groups: sudo
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    # Password: 'openclaw' (hashed)
    passwd: {{ vm_user_password_hash }}
    lock_passwd: false
    ssh_authorized_keys:
      - {{ vm_ssh_authorized_keys }}

# Package updates and installations (disabled for faster boot)
package_update: false
package_upgrade: false

packages:
  - qemu-guest-agent
  - openssh-server
  - spice-vdagent

# Enable SSH with password authentication
ssh_pwauth: true

# Grow root filesystem
growpart:
  mode: auto
  devices: ['/']

# Run commands on first boot
runcmd:
  - systemctl enable qemu-guest-agent
  - systemctl start qemu-guest-agent
  - echo "{{ agent_name }} agent VM initialized" > /etc/motd

# Final message
final_message: "{{ agent_name }} cloud-init complete after $UPTIME seconds"
