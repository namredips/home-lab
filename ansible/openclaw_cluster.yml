---
# OpenClaw Virtual Employee Infrastructure Deployment
# This playbook deploys the complete "Mount Olympus" agent cluster

- name: Prepare hypervisor hosts
  hosts: hypervisors
  gather_facts: yes
  roles:
    - { role: host_prepare, tags: ['host_prepare'] }

- name: Setup libvirt hypervisors
  hosts: hypervisors
  gather_facts: yes
  roles:
    - { role: libvirt, tags: ['libvirt'] }

- name: Provision agent VMs
  hosts: hypervisors
  gather_facts: yes
  roles:
    - { role: agent_vm, tags: ['agent_vm'] }

- name: Install desktop environment on agents (Phase 2)
  hosts: agent_vms
  gather_facts: yes
  serial: 2  # Install 2 VMs at a time to avoid memory pressure
  roles:
    - { role: agent_desktop, tags: ['agent_desktop'] }

- name: Provision agent environments
  hosts: agent_vms
  gather_facts: yes
  roles:
    - { role: agent_provision, tags: ['agent_provision'] }

- name: Install and configure Ollama
  hosts: agent_vms
  gather_facts: yes
  roles:
    - { role: ollama, tags: ['ollama'] }

- name: Setup OpenClaw agents
  hosts: agent_vms
  gather_facts: yes
  roles:
    - { role: openclaw, tags: ['openclaw'] }

- name: Configure VM backups
  hosts: hypervisors
  gather_facts: yes
  roles:
    - { role: vm_backup, tags: ['vm_backup'] }

- name: Display deployment summary
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Show deployment completion
      debug:
        msg:
          - "=========================================="
          - "OpenClaw Virtual Employee Infrastructure"
          - "Mount Olympus Agent Cluster"
          - "=========================================="
          - ""
          - "DEPLOYMENT COMPLETE"
          - ""
          - "Infrastructure deployed:"
          - "  - 5 hypervisor hosts (libvirt/KVM)"
          - "  - 8 agent VMs (Ubuntu Desktop 24.04 LTS)"
          - "  - Ollama Cloud LLM provider (8 cloud models per VM)"
          - "  - Discord communication platform (Guild ID: 832250938571227217)"
          - ""
          - "Agents deployed:"
          - "  - Zeus (10.220.1.199) - PM, orchestration"
          - "  - Athena (10.220.1.123) - Senior Developer (Architecture)"
          - "  - Apollo (10.220.1.153) - Development"
          - "  - Artemis (10.220.1.194) - Development"
          - "  - Hermes (10.220.1.198) - Development"
          - "  - Perseus (10.220.1.113) - Development"
          - "  - Prometheus (10.220.1.156) - Development"
          - "  - Ares (10.220.1.22) - Development"
          - ""
          - "REMOTE ACCESS:"
          - "  - Console login: agent / openclaw"
          - "  - SSH: ssh agent@<vm-ip> (password: openclaw)"
          - "  - XRDP: rdp://<vm-ip>:3389 (agent / openclaw)"
          - ""
          - "LLM CONFIGURATION:"
          - "  - Provider: Ollama Cloud"
          - "  - Primary Model: kimi-k2.5:cloud"
          - "  - All 8 cloud models available on each VM"
          - "  - Verify: ssh agent@<vm-ip> 'ollama list'"
          - ""
          - "SERVICES:"
          - "  - OpenClaw Gateway: systemctl status openclaw-gateway"
          - "  - Web Dashboard: http://<vm-ip>:18789"
          - "  - Discord: Guild ID 832250938571227217"
          - ""
          - "MANUAL STEPS (if needed):"
          - "  1. Configure Google Workspace catch-all email"
          - "  2. Configure GitHub accounts for agents"
          - "  3. Start services: sudo systemctl start openclaw-gateway"
          - ""
          - "See docs/DEPLOYMENT_RUNBOOK.md for detailed instructions"
          - "=========================================="
